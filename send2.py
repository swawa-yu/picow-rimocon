from machine import *
import time
# from signals import light

pin_sw = Pin(14, Pin.IN, Pin.PULL_DOWN)
pin_led_ir = Pin(15, Pin.OUT)

# 38kHzのキャリア周波数を生成するためのPWM設定
pwm_led_ir = PWM(pin_led_ir)
pwm_led_ir.freq(38000)


def set_led_ir(val):
    if val:
        pwm_led_ir.duty_u16(
            21845
        )  # 33% Duty cycleでHIGHのパルス (65536 * 0.33 ≈ 21845)
    else:
        pwm_led_ir.duty_u16(0)


# 信号を送信する関数
def send_signal(signal):
    for duration in signal:
        if duration > 0:
            set_led_ir(1)
        else:
            set_led_ir(0)
        time.sleep_us(abs(duration))
    set_led_ir(0)  # 信号をオフにするのを忘れないこと


signals = [
    [
        3501,
        -1716,
        465,
        -393,
        471,
        -1283,
        460,
        -397,
        470,
        -402,
        471,
        -396,
        470,
        -393,
        473,
        -396,
        485,
        -404,
        455,
        -397,
        472,
        -395,
        486,
        -394,
        472,
        -395,
        470,
        -395,
        471,
        -1276,
        471,
        -395,
        470,
        -404,
        472,
        -396,
        471,
        -394,
        471,
        -397,
        471,
        -394,
        485,
        -396,
        472,
        -1270,
        472,
        -1265,
        469,
        -1273,
        474,
        -395,
        471,
        -393,
        470,
        -1266,
        472,
        -395,
        473,
        -396,
        485,
        -394,
        471,
        -394,
        471,
        -412,
        457,
        -395,
        486,
        -395,
        473,
        -394,
        470,
        -396,
        471,
        -397,
        484,
        -399,
        470,
        -395,
        469,
        -396,
        474,
        -395,
        469,
        -394,
        486,
        -393,
        471,
        -395,
        471,
        -399,
        472,
        -396,
        471,
        -393,
        487,
        -399,
        471,
        -394,
        471,
        -401,
        472,
        -393,
        470,
        -395,
        484,
        -393,
        471,
        -396,
        471,
        -396,
        472,
        -395,
        484,
        -396,
        472,
        -1271,
        458,
        -1269,
        472,
        -394,
        484,
        -395,
        469,
        -394,
        484,
        -395,
        470,
        -394,
        472,
        -9960,
        3518,
        -1705,
        471,
        -398,
        471,
        -1268,
        470,
        -396,
        485,
        -392,
        471,
        -392,
        475,
        -397,
        471,
        -395,
        485,
        -395,
        470,
        -397,
        471,
        -393,
        470,
        -395,
        486,
        -396,
        472,
        -397,
        472,
        -1273,
        470,
        -393,
        471,
        -396,
        471,
        -397,
        469,
        -419,
        458,
        -398,
        470,
        -394,
        470,
        -395,
        485,
        -1267,
        474,
        -1267,
        470,
        -1273,
        456,
        -394,
        484,
        -393,
        471,
        -1273,
        471,
        -392,
        473,
        -395,
        484,
        -397,
        473,
        -397,
        470,
        -398,
        470,
        -393,
        471,
        -397,
        474,
        -393,
        484,
        -396,
        474,
        -397,
        471,
        -399,
        471,
        -395,
        470,
        -396,
        472,
        -1274,
        471,
        -392,
        470,
        -394,
        486,
        -394,
        470,
        -397,
        472,
        -398,
        470,
        -1270,
        471,
        -393,
        478,
        -394,
        470,
        -396,
        485,
        -398,
        472,
        -397,
        471,
        -1268,
        471,
        -1269,
        470,
        -399,
        461,
        -395,
        485,
        -397,
        470,
        -395,
        471,
        -397,
        470,
        -399,
        473,
        -394,
        484,
        -390,
        470,
        -397,
        470,
        -1274,
        475,
        -1266,
        472,
        -1270,
        470,
        -1267,
        470,
        -1270,
        471,
        -399,
        471,
        -1271,
        471,
        -394,
        471,
        -1274,
        470,
        -393,
        470,
        -398,
        471,
        -394,
        484,
        -395,
        474,
        -396,
        470,
        -396,
        470,
        -397,
        470,
        -392,
        487,
        -393,
        470,
        -397,
        471,
        -393,
        486,
        -393,
        470,
        -391,
        484,
        -402,
        458,
        -395,
        484,
        -394,
        473,
        -395,
        471,
        -1274,
        470,
        -1275,
        457,
        -398,
        485,
        -398,
        469,
        -400,
        470,
        -395,
        470,
        -393,
        472,
        -394,
        487,
        -392,
        472,
        -398,
        471,
        -393,
        471,
        -396,
        486,
        -1272,
        457,
        -1279,
        470,
        -399,
        471,
        -393,
        469,
        -395,
        471,
        -395,
        486,
        -394,
        476,
        -394,
        471,
        -396,
        471,
        -394,
        470,
        -394,
        486,
        -395,
        470,
        -393,
        472,
        -392,
        487,
        -394,
        470,
        -398,
        470,
        -397,
        470,
        -394,
        484,
        -395,
        471,
        -397,
        472,
        -1270,
        470,
        -399,
        471,
        -1273,
        471,
        -396,
        471,
        -395,
        472,
        -394,
        471,
        -1272,
        476,
        -394,
        470,
        -398,
        470,
        -398,
        473,
        -394,
        484,
        -398,
        470,
        -395,
        470,
        -402,
        470,
        -395,
        470,
        -395,
        484,
        -395,
        472,
        -393,
        469,
        -395,
        485,
        -395,
        474,
        -391,
        470,
        -418,
        457,
        -392,
        485,
        -397,
        470,
        -1272,
        457,
        -1246,
        499,
        -401,
        470,
        -1270,
        470,
        -389,
        485,
        -395,
        470,
        -1271,
        470,
    ],
    [
        9122,
        -4469,
        652,
        -503,
        643,
        -492,
        645,
        -501,
        645,
        -480,
        658,
        -504,
        630,
        -506,
        642,
        -478,
        657,
        -1613,
        643,
        -1594,
        665,
        -1590,
        659,
        -1593,
        657,
        -1603,
        643,
        -1601,
        656,
        -1623,
        629,
        -1619,
        644,
        -485,
        643,
        -502,
        642,
        -1602,
        656,
        -503,
        632,
        -503,
        632,
        -1601,
        659,
        -506,
        631,
        -502,
        643,
        -477,
        660,
        -1597,
        659,
        -477,
        657,
        -1599,
        657,
        -1598,
        657,
        -477,
        656,
        -1604,
        644,
        -1622,
        643,
        -1613,
        632,
    ],
    [
        9111,
        -4524,
        586,
        -530,
        630,
        -512,
        616,
        -535,
        614,
        -538,
        587,
        -532,
        630,
        -530,
        588,
        -527,
        615,
        -1658,
        585,
        -1658,
        600,
        -1659,
        615,
        -1630,
        608,
        -1659,
        614,
        -1626,
        628,
        -1630,
        615,
        -1648,
        586,
        -547,
        599,
        -526,
        630,
        -1627,
        614,
        -531,
        631,
        -1619,
        601,
        -1661,
        615,
        -534,
        614,
        -508,
        628,
        -532,
        588,
        -1650,
        616,
        -534,
        585,
        -1652,
        629,
        -506,
        616,
        -535,
        599,
        -1651,
        601,
        -1658,
        615,
        -1634,
        600,
    ],
]

# # メインプログラム
# while True:
#     if pin_sw.value():
#         print("send signal on")
#         send_signal(signals[0])
#         time.sleep(1)

# send_signal(signals[0])

# while True:
#     send_signal(signals[0])
#     time.sleep(1)
#     send_signal(signals[1])
#     time.sleep(1)
